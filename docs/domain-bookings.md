# Bookings Domain Guide ðŸŽŸï¸

The **Bookings Domain** manages the reservation of tickets for events. It acts as the link between Users and Events.

**Directory**: `src/features/bookings/`

---

## 1. Overview

This feature records confirmed bookings. A booking is typically created _after_ a successful payment or free registration.

**Key Capabilities:**

- **Record Booking**: Saves the link between a user and an event.
- **User My Bookings**: Fetches events a user is attending.
- **Organizer Orders**: Fetches bookings for events owned by a user (Organizer view).

---

## 2. Data Model

The `bookingTable` (`src/drizzle/schemas/booking-table.ts`) is a junction table:

| Field       | Type   | Description                 |
| :---------- | :----- | :-------------------------- |
| `id`        | UUID   | Primary Key.                |
| `user_id`   | String | User who booked (Clerk ID). |
| `event_id`  | UUID   | Event booked.               |
| `createdAt` | Date   | Timestamp of booking.       |

**Relations:**

- `user`: Belongs to one User.
- `event`: Belongs to one Event.

---

## 3. Actions & Mutations

**IMPORTANT**: Bookings are rarely created manually via UI mutations. Instead, they are generated by **Background Jobs** (Inngest) responding to successful Stripe payments or Clerk events.

- `insertNewBookingRecordAction`: Internal action called by the Stripe Webhook handler (`src/services/inngest/functions/stripe.ts`) to permanently record the booking.

> [!NOTE]
> There are placeholders for `updateBookingAction`, `cancelBookingAction`, and `deleteBookingAction` for future features (e.g., refunds).

---

## 4. Querying Data

Data is fetched via `actions/query.ts`:

| Action                          | Description                                        | Cache Tag           |
| :------------------------------ | :------------------------------------------------- | :------------------ |
| `GetUserBookingsAction`         | Returns bookings for the _Attendee_ (My Tickets).  | `bookings-[userId]` |
| `GetUserBookingsAsOrdersAction` | Returns bookings made _on_ the Organizer's events. | `orders-[userId]`   |
| `GetAllBookingsAction`          | Admin-only: Returns all bookings in the system.    | _None_              |

> [!TIP]
> **Organizer vs. Attendee**:
>
> - `GetUserBookingsAction` = "Where am I going?"
> - `GetUserBookingsAsOrdersAction` = "Who is coming to my events?"
